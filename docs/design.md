# **設計書**  
**プロジェクト名：** Pyxel製ローグライトアクションゲーム  
**作成日：** 2024年6月  
**作成者：** （あなたの名前）  

---

## **1. システム概要**  
本ゲームは、プレイヤーが自動攻撃を行いながら大量の敵を倒し続けるローグライトアクションゲームである。時間経過とともに敵の強さが増し、プレイヤーはレベルアップや武器の強化を通じて生き延びることを目指す。  

また、本ゲームの特徴として、**プレイヤーの行動や敵の種類に応じて音楽がリアルタイムに変化するシステム**を導入し、ゲームプレイと音楽の融合を楽しめるようにする。さらに、**GitHub Pagesを利用してWebブラウザ上でもプレイ可能にする**。  

---

## **2. システム構成**  
本ゲームは、以下の主要コンポーネントで構成される。  

### **2.1 クラス構成**  
```plaintext
+------------------+
| Game            |
|------------------|
| - player: Player |
| - enemies: list  |
| - weapons: list  |
| - stage: Stage   |
| - ui: UI         |
| - music: Music   |
|------------------|
| + update()       |
| + draw()         |
+------------------+

+------------------+
| Player          |
|------------------|
| - x: int        |
| - y: int        |
| - hp: int       |
| - speed: int    |
| - weapons: list |
|------------------|
| + move()        |
| + take_damage() |
| + level_up()    |
+------------------+

+------------------+
| Enemy           |
|------------------|
| - x: int        |
| - y: int        |
| - hp: int       |
| - speed: int    |
|------------------|
| + move()        |
| + take_damage() |
+------------------+

+------------------+
| Weapon          |
|------------------|
| - type: str     |
| - level: int    |
| - cooldown: int |
|------------------|
| + attack()      |
| + upgrade()     |
+------------------+

+------------------+
| Stage           |
|------------------|
| - time: int     |
| - enemies: list |
|------------------|
| + spawn_enemy() |
| + update()      |
+------------------+

+------------------+
| UI              |
|------------------|
| + draw_hp()     |
| + draw_score()  |
| + draw_timer()  |
+------------------+

+------------------+
| Music           |
|------------------|
| - bpm: int      |
| - melody: list  |
| - rhythm: list  |
|------------------|
| + update_music()|
| + play()        |
+------------------+
```

---

## **3. 音楽生成システム**  

### **3.1 音楽の変化要素**  
- **プレイヤーの行動**  
  - 移動速度が速いとテンポが上がる  
  - 攻撃の種類によってメロディが変化  

- **敵の種類と数**  
  - 敵が多いとリズムが激しくなる  
  - 特定の敵が出現すると特定の楽器が追加される  

- **時間経過**  
  - ゲームが進むにつれて音楽が盛り上がる  

### **3.2 実装方法**  
- Pyxelの`pyxel.play()`を活用し、リアルタイムで音楽を変更  
- BPM（テンポ）を動的に変更  
- メロディとリズムをリストで管理し、状況に応じて組み合わせを変える  

---

## **4. Web対応（GitHub Pages）**  

### **4.1 Web対応の方法**  
- **Pyodideを使用**（PythonコードをWebAssemblyに変換）  
- **Emscriptenを活用**（PyxelをJavaScript経由で動作させる）  
- **WebAudio APIを利用**（音楽生成をブラウザ上で処理）  

### **4.2 デプロイ手順**  
1. `Pyodide` を使ってPythonコードをWebAssemblyに変換  
2. `index.html` を作成し、Pyodideを読み込む  
3. GitHub Pagesにデプロイ  

---

## **5. 主要な処理フロー**  

### **5.1 ゲームループ**
```plaintext
1. update()
   - プレイヤーの移動処理
   - 敵の移動処理
   - 武器の攻撃処理
   - 敵の出現処理
   - レベルアップ処理
   - 音楽の更新
   - ゲームオーバー判定

2. draw()
   - 背景の描画
   - プレイヤーの描画
   - 敵の描画
   - 武器の描画
   - UIの描画
```

---

## **6. 画面設計**  

### **6.1 メインゲーム画面**
```
+----------------------------------+
| HP: ████████  Score: 12345      |
|----------------------------------|
|                                  |
|        (プレイヤー)              |
|                                  |
|   (敵)       (敵)       (敵)     |
|                                  |
| Timer: 02:30                     |
+----------------------------------+
```

---

## **7. 実装予定の機能**  

| 機能 | 優先度 |  
|------|------|  
| プレイヤーの移動 | 高 |  
| 敵の出現と追跡 | 高 |  
| 自動攻撃システム | 高 |  
| 経験値とレベルアップ | 高 |  
| 武器の成長システム | 高 |  
| UIの表示（HP、スコア、タイマー） | 中 |  
| ステージの時間経過による変化 | 中 |  
| 音楽生成システム | 高 |  
| Web対応（GitHub Pages） | 高 |  
| ボスの出現 | 低 |  
| アイテムドロップ | 低 |  

---

## **8. まとめ**  
本設計書では、ローグライトアクションゲームのクラス構成、音楽生成システム、Web対応の方法を定義した。まずは基本機能を実装し、徐々に音楽生成やWeb対応を進めていく。  

---

この内容で問題なければ、次のステップとして実装に進めていきましょう！