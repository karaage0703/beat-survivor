# **要件定義書**  
**プロジェクト名：** Pyxel製ローグライトアクションゲーム  
**作成日：** 2024年6月  
**作成者：** （あなたの名前）  

---

## **1. 概要**  
本プロジェクトは、PythonのPyxelライブラリを使用して、ローグライトアクションゲームを開発することを目的とする。プレイヤーは自動攻撃を行いながら、迫りくる大量の敵を倒し続け、時間経過とともに強化される敵に対抗しながら生き延びることを目指す。  

また、本ゲームの特徴として、**プレイヤーの行動や敵の種類に応じて音楽がリアルタイムに変化するシステム**を導入し、ゲームプレイと音楽の融合を楽しめるようにする。さらに、**GitHub Pagesを利用してWebブラウザ上でもプレイ可能にする**。  

---

## **2. ゲームの基本仕様**  

### **2.1 プレイヤーの操作**  
- **移動のみ可能**（攻撃は自動）  
- **操作方法：** 方向キー（上下左右）  
- **HP（体力）を持ち、敵の攻撃を受けると減少**  
- **HPが0になるとゲームオーバー**  

### **2.2 攻撃システム**  
- **一定時間ごとに自動攻撃**  
- **武器ごとに異なる攻撃パターン**  
  - 例：ナイフ（前方に飛ぶ）、聖水（ランダムな位置に落ちる）  
- **レベルアップで攻撃の種類や威力を強化可能**  

### **2.3 敵の出現と行動**  
- **プレイヤーに向かって移動する敵が大量に出現**  
- **敵の種類ごとに異なる動き**  
  - 例：遅いゾンビ、速いコウモリ  
- **時間経過とともに敵の数や強さが増加**  

### **2.4 経験値とレベルアップ**  
- **敵を倒すと経験値（ジェムなど）をドロップ**  
- **一定量の経験値を集めるとレベルアップ**  
- **レベルアップ時に新しい武器やスキルを選択可能**  

### **2.5 武器とスキルの成長**  
- **武器のレベルアップで攻撃範囲や威力が増加**  
- **特定の条件を満たすと「進化武器」に変化**  
- **パッシブスキルで移動速度や攻撃速度を向上**  

### **2.6 ステージと時間経過**  
- **時間経過で敵の強さが変化**  
- **一定時間生き残るとボスが出現**  
- **ステージの広さを決め、無限に移動できるようにする**  

---

## **3. 音楽生成システム**  

### **3.1 音楽の変化要素**  
- **プレイヤーの行動**  
  - 移動速度が速いとテンポが上がる  
  - 攻撃の種類によってメロディが変化  

- **敵の種類と数**  
  - 敵が多いとリズムが激しくなる  
  - 特定の敵が出現すると特定の楽器が追加される  

- **時間経過**  
  - ゲームが進むにつれて音楽が盛り上がる  

### **3.2 実装方法**  
- Pyxelの`pyxel.play()`を活用し、リアルタイムで音楽を変更  
- BPM（テンポ）を動的に変更  
- メロディとリズムをリストで管理し、状況に応じて組み合わせを変える  

---

## **4. Web対応（GitHub Pages）**  

### **4.1 Web対応の方法**  
- **Pyodideを使用**（PythonコードをWebAssemblyに変換）  
- **Emscriptenを活用**（PyxelをJavaScript経由で動作させる）  
- **WebAudio APIを利用**（音楽生成をブラウザ上で処理）  

### **4.2 デプロイ手順**  
1. `Pyodide` を使ってPythonコードをWebAssemblyに変換  
2. `index.html` を作成し、Pyodideを読み込む  
3. GitHub Pagesにデプロイ  

---

## **5. 開発スケジュール**  

| フェーズ | タスク | 期間 |  
|----------|--------|------|  
| **フェーズ1** | プレイヤーの移動を実装 | 1週間 |  
| **フェーズ2** | 敵の出現と追跡AIを実装 | 1週間 |  
| **フェーズ3** | 自動攻撃システムを実装 | 1週間 |  
| **フェーズ4** | 経験値とレベルアップシステムを実装 | 1週間 |  
| **フェーズ5** | 武器の種類と成長システムを実装 | 2週間 |  
| **フェーズ6** | ステージと時間経過のシステムを実装 | 2週間 |  
| **フェーズ7** | 音楽生成システムの実装 | 2週間 |  
| **フェーズ8** | Web対応（Pyodide/Emscripten） | 2週間 |  
| **フェーズ9** | UI・スコア表示・ゲームバランス調整 | 2週間 |  
| **フェーズ10** | 最終テスト・デバッグ・リリース | 2週間 |  

---

## **6. 想定される課題と対策**  

| 課題 | 対策 |  
|------|------|  
| Pyxelのパフォーマンス制限 | 敵の数を制限し、描画負荷を軽減 |  
| ゲームバランスの調整 | テストプレイを重ね、適切な難易度を設定 |  
| 武器・スキルのバリエーション不足 | 追加要素を段階的に実装 |  
| Web対応の技術的課題 | PyodideやEmscriptenの動作検証を行う |  
| 音楽生成のリアルタイム処理 | WebAudio APIを活用し、負荷を最適化 |  

---

## **7. まとめ**  
本プロジェクトでは、Pyxelを用いてローグライトアクションゲームを開発する。プレイヤーは自動攻撃を駆使しながら大量の敵を倒し、レベルアップや武器の成長を通じて強化されていく。さらに、プレイヤーの行動や敵の種類に応じて音楽がリアルタイムに変化するシステムを導入し、ゲームプレイと音楽の融合を楽しめるようにする。  

また、GitHub Pagesを利用してWebブラウザ上でもプレイ可能にすることで、より多くのユーザーに遊んでもらえる環境を整える。開発は段階的に進め、基本機能を実装した後に追加要素を検討する。最終的には、シンプルながらも中毒性のあるゲーム体験を提供することを目指す。  

---

以上が要件定義書となります。  
この内容で問題なければ、次のステップとして設計や実装に進めていきましょう！